<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>niwi.nz : Python and Node performance tests</title>
    <meta name=viewport content='width=200, initial-scale=1'>

  <meta name="desciption" content="This is another benchmark for view performance of python on the web. The main idea is to see python3 performance compared to python2 serving simple wsgi app. Also compared with nodejs performance, performing the same task. For benchmarks are used these software: uwsgi-1.4.5 + python-3.3.0 uwsgi-1.4.5 + python-2.7.3 gunicorn-0.17.2 + python-3.3.0 gunicorn-0.17.2 + python-2.7.3 nodejs-v0.8.19 + v8-3.16.4.1 Setup environment This is a script used on python benchmarks: from __future__ import..." />
    <meta name="author" content="Andrey Antukh" />

    <link rel="stylesheet" href="https://niwi.nz/theme/css/main.css" />

      <link href="https://niwi.nz/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="niwi.nz Atom Feed" />

      <link href="https://niwi.nz/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="niwi.nz RSS Feed" />

    <!--[if IE]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!--[if lte IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="https://niwi.nz/css/ie.css"/>
        <script src="https://niwi.nz/js/IE8.js" type="text/javascript"></script>
    <![endif]-->

    <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="https://niwi.nz/css/ie6.css"/>
    <![endif]-->
  </head>

  <body>
    <div id="wrap">
      <div id="container">

        <div class="entry">
  <header>
    <a href="https://niwi.nz"><small>(return to home)</small></a>
    <h1>
      <a href="https://niwi.nz/2013/02/18/python-node-http-performance/" id="page-title">Python and Node performance tests</a>
    </h1>
    <div class="article-meta">
        <small class="time">
          Date:
          <time datetime="2013-02-18T00:00:00+00:00">
            Mon 18 February 2013
          </time>
        </small>
      <br />
      <small class="tags">
        Tags:
          <a href="https://niwi.nz/tag/python.html">python,           </a>
          <a href="https://niwi.nz/tag/wsgi.html">wsgi,           </a>
          <a href="https://niwi.nz/tag/nodejs.html">nodejs          </a>
      </small>

      <br />
      <small class="tags">
        Author:
          <span>Andrey Antukh</span>      </small>
    </div>
  </header>
  <article>
    <div id="article-content">
      <p>This is another benchmark for view performance of python on the web. The main idea is
to see python3 performance compared to python2 serving simple wsgi app.</p>
<p>Also compared with nodejs performance, performing the same task.</p>
<p>For benchmarks are used these software:</p>
<ul class="simple">
<li>uwsgi-1.4.5 + python-3.3.0</li>
<li>uwsgi-1.4.5 + python-2.7.3</li>
<li>gunicorn-0.17.2 + python-3.3.0</li>
<li>gunicorn-0.17.2 + python-2.7.3</li>
<li>nodejs-v0.8.19 + v8-3.16.4.1</li>
</ul>
<div class="section" id="setup-environment">
<h2>Setup environment</h2>
<p>This is a script used on python benchmarks:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="k">def</span> <span class="nf">u</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">common_response</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">u</span><span class="p">(</span><span class="s2">&quot;text:item:</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;other:item.</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;other:subitem.</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subitem</span><span class="p">))</span>

    <span class="k">yield</span> <span class="n">u</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">application_py2</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="sa">b</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">common_response</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">application_py3</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">start_response</span><span class="p">(</span><span class="s1">&#39;200 OK&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">common_response</span><span class="p">()</span>
</pre></div>
<p>And this is a code used with nodejs:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">});</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mf">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&quot;text:item:&quot;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mf">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mf">2</span> <span class="o">==</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;other:item.&quot;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">x</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span> <span class="nx">x</span><span class="o">&lt;</span><span class="nx">i</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;other:subitem.&quot;</span> <span class="o">+</span> <span class="nx">x</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">))</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">8001</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="server-setup">
<h2>Server setup</h2>
<p>There are a list of a commands used to start wsgi and nodejs servers.</p>
<p><strong>Gunicorn + Python3</strong></p>
<div class="highlight"><pre><span></span><span class="go">gunicorn -b 0.0.0.0:8001 -w1 app:application_py3</span>
</pre></div>
<p><strong>Gunicorn + Python2</strong></p>
<div class="highlight"><pre><span></span><span class="go">gunicorn -b 0.0.0.0:8001 -w1 app:application_py2</span>
</pre></div>
<p><strong>uWsgi + Python3</strong></p>
<div class="highlight"><pre><span></span><span class="go">uwsgi-py3 --http 0.0.0.0:8001 --master -p 1 -w app:application_py3 -L</span>
</pre></div>
<p><strong>uWsgi + Python2</strong></p>
<div class="highlight"><pre><span></span><span class="go">uwsgi --http 0.0.0.0:8001 --master -p 1 -w app:application_py2 -L</span>
</pre></div>
<p><strong>NodeJS</strong></p>
<div class="highlight"><pre><span></span><span class="go">node app.js</span>
</pre></div>
</div>
<div class="section" id="benchmark">
<h2>Benchmark</h2>
<p>For measure the performance, I used apache bench tool (ab) and httperf, with 1, 5 and 10 concurrent
clients making 1000 requests with keep-alive enabled.</p>
<p><strong>Note:</strong> The results are average of multiple executions.</p>
<div class="section" id="req-s-performance">
<h3>Req/s performance</h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Server</th>
<th class="head">1 client</th>
<th class="head">5 clients</th>
<th class="head">10 clients</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>uWsgi+python3</td>
<td>235/s</td>
<td>315/s</td>
<td>323/s</td>
</tr>
<tr><td>uWsgi+python2</td>
<td>155/s</td>
<td>185/s</td>
<td>186/s</td>
</tr>
<tr><td>gunicorn+python3</td>
<td>137/s</td>
<td>137/s</td>
<td>137/s</td>
</tr>
<tr><td>gunicorn+python2</td>
<td>130/s</td>
<td>135/s</td>
<td>135/s</td>
</tr>
<tr><td>nodejs</td>
<td>330/s</td>
<td>375/s</td>
<td>375/s</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="latency">
<h3>Latency</h3>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Server</th>
<th class="head">1 client</th>
<th class="head">5 clients</th>
<th class="head">10 clients</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>uWsgi+python3</td>
<td>4ms</td>
<td>15ms</td>
<td>30ms</td>
</tr>
<tr><td>uWsgi+python2</td>
<td>6ms</td>
<td>27ms</td>
<td>50ms</td>
</tr>
<tr><td>gunicorn+python3</td>
<td>7ms</td>
<td>35ms</td>
<td>72ms</td>
</tr>
<tr><td>gunicorn+python2</td>
<td>8ms</td>
<td>36ms</td>
<td>73ms</td>
</tr>
<tr><td>nodejs</td>
<td>2ms</td>
<td>13ms</td>
<td>27ms</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Additionally I've tested both: uwsgi with python3 and nodejs with a more clients
and its scales proportionally wery well, accepting same number requests per seconds and
increasing a response latency without any errors (tests up to 400 concurrent clients).</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>What I really wanted to see here is if python3 is a viable option for web and deny all of
the myths that python3 is slow.</p>
<p>With respect to the application server, uwsgi is clearly faster. I am sure that if testing it
in a more powerful environment, could be on par with nodejs performance.</p>
<p>In these tests nodejs clearly has better performance, but as Guido says, performance is
not always the most important.</p>
<p>I usually use gunicorn for its simplicity and simplicity. Gunicorn is not the fastest,
but in my opinon, in real applications, there are other major bottlenecks to solve,
before noting the bottleneck in wsgi server.</p>
</div>

    </div>
  </article>
        </div>
      </div>

    </div>
  </body>
</html>