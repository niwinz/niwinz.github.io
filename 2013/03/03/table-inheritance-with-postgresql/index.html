<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>niwi.nz : Table inheritance with PostgreSQL</title>
    <meta name=viewport content='width=200, initial-scale=1'>

  <meta name="desciption" content="Table inheritance is one of the features in PostgreSQL has impressed me a lot, I have discovered its potential recently, research on partitioning tables (I explain it on the next article). The idea of this article is to see how it works, and how we can take advantage of this feature. Sure we&#39;ve had many times the problem having different heterogeneous objects with a common base (of database fields). Instead of a simple solution, mantain a separate table for a heterogeneous fields and..." />
    <meta name="author" content="Andrey Antukh" />

    <link rel="stylesheet" href="https://www.niwi.nz/theme/css/main.css" />

      <link href="https://www.niwi.nz/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="niwi.nz Atom Feed" />

      <link href="https://www.niwi.nz/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="niwi.nz RSS Feed" />

    <!--[if IE]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!--[if lte IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="https://www.niwi.nz/css/ie.css"/>
        <script src="https://www.niwi.nz/js/IE8.js" type="text/javascript"></script>
    <![endif]-->

    <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="https://www.niwi.nz/css/ie6.css"/>
    <![endif]-->
  </head>

  <body>
    <div id="wrap">
      <div id="container">

        <div class="entry">
  <header>
    <a href="https://www.niwi.nz"><small>(return to home)</small></a>
    <h1>
      <a href="https://www.niwi.nz/2013/03/03/table-inheritance-with-postgresql/" id="page-title">Table inheritance with PostgreSQL</a>
    </h1>
    <div class="article-meta">
        <small class="time">
          Date:
          <time datetime="2013-03-03T00:00:00+00:00">
            Sun 03 March 2013
          </time>
        </small>
      <br />
      <small class="tags">
        Tags:
          <a href="https://www.niwi.nz/tag/postgresql.html">postgresql          </a>
      </small>

      <br />
      <small class="tags">
        Author:
          <span>Andrey Antukh</span>      </small>
    </div>
  </header>
  <article>
    <div id="article-content">
      <p>Table inheritance is one of the features in PostgreSQL has impressed me a lot, I have
discovered its potential recently, research on partitioning tables (I explain it on the next article).
The idea of this article is to see how it works, and how we can take advantage of this feature.</p>
<p>Sure we've had many times the problem having different heterogeneous objects with a common base
(of database fields). Instead of a simple solution,  mantain a separate table for a heterogeneous fields
and make a join query when you want obtain a list of some data on one child table, you can use this
feature. With PostgreSQL, table inheritance can be defined in very easy way, see this simple example that defines
a master table post and two childs: one child without additional fields and other with tag fields:</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mf">100</span><span class="p">),</span><span class="w"> </span><span class="k">content</span><span class="w"> </span><span class="nb">text</span><span class="p">);</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">post_without_tags</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">INHERITS</span><span class="w"> </span><span class="p">(</span><span class="n">post</span><span class="p">);</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">post_with_tags</span><span class="w"> </span><span class="p">(</span><span class="n">tags</span><span class="w"> </span><span class="nb">text</span><span class="p">[])</span><span class="w"> </span><span class="k">INHERITS</span><span class="w"> </span><span class="p">(</span><span class="n">post</span><span class="p">);</span><span class="w"></span>

<span class="c1">--- Insert sample data</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">post_without_tags</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">content</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;title-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;content-1&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">post_without_tags</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">content</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;title-2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;content-2&#39;</span><span class="p">);</span><span class="w"></span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">post_with_tags</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">content</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;title-3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;content-3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;foo&quot;,&quot;bar&quot;}&#39;</span><span class="o">::</span><span class="nb">text</span><span class="p">[]);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">post_with_tags</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">content</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;title-4&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;content-4&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{&quot;foo&quot;,&quot;bar&quot;}&#39;</span><span class="o">::</span><span class="nb">text</span><span class="p">[]);</span><span class="w"></span>
</pre></div>
<p>Now, you can make query to the last created tables:</p>
<div class="highlight"><pre><span></span><span class="gp">test=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">post_with_tags</span><span class="p">;</span><span class="w"></span>
<span class="go"> id |  title  |  content  |   tags</span>
<span class="go">----+---------+-----------+-----------</span>
<span class="go">  3 | title-3 | content-3 | {foo,bar}</span>
<span class="go">  4 | title-4 | content-4 | {foo,bar}</span>
<span class="go">(2 rows)</span>

<span class="gp">test=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">post_without_tags</span><span class="p">;</span><span class="w"></span>
<span class="go"> id |  title  |  content</span>
<span class="go">----+---------+-----------</span>
<span class="go">  1 | title-1 | content-1</span>
<span class="go">  2 | title-2 | content-2</span>
<span class="go">(2 rows)</span>
</pre></div>
<p>But if you make a query on a master table (post table), we will obtain all posts, from
each child table. See example:</p>
<div class="highlight"><pre><span></span><span class="gp">test=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">post</span><span class="p">;</span><span class="w"></span>
<span class="go"> id |  title  |  content</span>
<span class="go">----+---------+-----------</span>
<span class="go">  1 | title-1 | content-1</span>
<span class="go">  2 | title-2 | content-2</span>
<span class="go">  3 | title-3 | content-3</span>
<span class="go">  4 | title-4 | content-4</span>
<span class="go">(4 rows)</span>
</pre></div>
<p>And this is a result of <strong>explain</strong>:</p>
<div class="highlight"><pre><span></span><span class="gp">test=#</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">analyze</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">post</span><span class="p">;</span><span class="w"></span>
<span class="go">                                                           QUERY PLAN</span>
<span class="go">---------------------------------------------------------------------------------------------------------------------------------</span>
<span class="go"> Result  (cost=0.00..25.30 rows=531 width=254) (actual time=0.012..0.034 rows=4 loops=1)</span>
<span class="go">   -&gt;  Append  (cost=0.00..25.30 rows=531 width=254) (actual time=0.009..0.023 rows=4 loops=1)</span>
<span class="go">         -&gt;  Seq Scan on post  (cost=0.00..0.00 rows=1 width=254) (actual time=0.002..0.002 rows=0 loops=1)</span>
<span class="go">         -&gt;  Seq Scan on post_without_tags post  (cost=0.00..12.80 rows=280 width=254) (actual time=0.004..0.007 rows=2 loops=1)</span>
<span class="go">         -&gt;  Seq Scan on post_with_tags post  (cost=0.00..12.50 rows=250 width=254) (actual time=0.003..0.006 rows=2 loops=1)</span>
<span class="go"> Total runtime: 0.066 ms</span>
<span class="go">(6 rows)</span>
</pre></div>
<p>As we can see, postgresql automatically search on both childs and return result with a common fields defined
on a master table.</p>
<p>Also, you can make other operations over post table, and all changes are propagated automatically to child tables. See a sample
example making a update:</p>
<div class="highlight"><pre><span></span><span class="gp">test=#</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">title</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;-foo&#39;</span><span class="p">;</span><span class="w"></span>
<span class="go">UPDATE 4</span>

<span class="gp">test=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">post</span><span class="p">;</span><span class="w"></span>
<span class="go"> id |    title    |  content</span>
<span class="go">----+-------------+-----------</span>
<span class="go">  1 | title-1-foo | content-1</span>
<span class="go">  2 | title-2-foo | content-2</span>
<span class="go">  3 | title-3-foo | content-3</span>
<span class="go">  4 | title-4-foo | content-4</span>
<span class="go">(4 rows)</span>

<span class="gp">test=#</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">post_without_tags</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="go"> id |    title    |  content</span>
<span class="go">----+-------------+-----------</span>
<span class="go">  1 | title-1-foo | content-1</span>
<span class="go">  2 | title-2-foo | content-2</span>
<span class="go">(2 rows)</span>
</pre></div>
<p>As I said at the beginning of the article, the real potential of this feature is going to be with a table partitioning.</p>
<div class="section" id="related-links">
<h2>Related links</h2>
<ul class="simple">
<li><a class="reference external" href="http://www.postgresql.org/docs/9.2/static/ddl-inherit.html">http://www.postgresql.org/docs/9.2/static/ddl-inherit.html</a></li>
</ul>
</div>

    </div>
  </article>
        </div>
      </div>

    </div>
  </body>
</html>